{"1748629916427":{"actionType":"saveAll","createdAt":"1748629916427","actionID":"1748629916427","userID":"#TEMP","path":"system.capsules.69b6448d-c0ac-4102-8748-210e1c6a043b.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"() => {\n  const path1 = 'all.forms.form1';\n  const path2 = 'sc.A1.results';\n  const allVal = tools.getCtData(path1);\n\n  const { rendTrib, desMed, irRet, edu, prev, dep } = allVal;\n  console.log({ irRet });\n\n  const toNum = str => parseFloat((str || '0').replace(',', '.'));\n\n  const totalDep = toNum(dep) * 2400;\n  const totalDed = toNum(desMed) + toNum(edu) + toNum(prev) + totalDep;\n  const calcBase = Math.max(0, toNum(rendTrib) - totalDed);\n\n  const tabelaIR = tools.getCtData('all.tabelaIR');\n  const faixaEncontrada = tabelaIR.find(faixa => calcBase <= faixa.limite);\n\n  const irDevido = Math.max(\n    0,\n    calcBase * (faixaEncontrada.aliquota / 100) - faixaEncontrada.deducao,\n  );\n\n  const resultado = toNum(irRet) - irDevido;\n\n  if (resultado >= 0) {\n    const res1 = \"Restituição: R$\" + resultado.toFixed(2);\n    console.log(res1);\n\n    const pass1 = { keyPath: [path2], value: [res1] };\n    tools.functions.setVar({ args: '', pass: pass1 });\n  } else {\n    const res2 = \"Imposto a pagar: R$' + Math.abs(resultado).toFixed(2);\n    console.log(res2);\n\n    const pass1 = { keyPath: [path2], value: [res2] };\n    tools.functions.setVar({ args: '', pass: pass1 });\n  }\n}","newValue":"() => {\n  const path1 = 'all.forms.form1';\n  const path2 = 'sc.A1.results';\n  const allVal = tools.getCtData(path1);\n\n  const { rendTrib, desMed, irRet, edu, prev, dep } = allVal;\n  console.log({ irRet });\n\n  const toNum = str => parseFloat((str || '0').replace(',', '.'));\n\n  const totalDep = toNum(dep) * 2400;\n  const totalDed = toNum(desMed) + toNum(edu) + toNum(prev) + totalDep;\n  const calcBase = Math.max(0, toNum(rendTrib) - totalDed);\n\n  const tabelaIR = tools.getCtData('all.tabelaIR');\n  const faixaEncontrada = tabelaIR.find(faixa => calcBase <= faixa.limite);\n\n  const irDevido = Math.max(\n    0,\n    calcBase * (faixaEncontrada.aliquota / 100) - faixaEncontrada.deducao,\n  );\n\n  const resultado = toNum(irRet) - irDevido;\n\n  if (resultado >= 0) {\n    const res1 = \"Restituição: R$\" + resultado.toFixed(2);\n    console.log(res1);\n\n    const pass1 = { keyPath: [path2], value: [res1] };\n    tools.functions.setVar({ args: '', pass: pass1 });\n  } else {\n    const res2 = \"Imposto a pagar: R$\" + Math.abs(resultado).toFixed(2);\n    console.log(res2);\n\n    const pass1 = { keyPath: [path2], value: [res2] };\n    tools.functions.setVar({ args: '', pass: pass1 });\n  }\n}"}}